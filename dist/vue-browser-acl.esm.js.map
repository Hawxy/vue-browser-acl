{"version":3,"file":"vue-browser-acl.esm.js","sources":["../node_modules/browser-acl/dist/browser-acl.esm.js","../index.js"],"sourcesContent":["function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t=\"GLOBAL_RULE\",r=function(e){return\"boolean\"==typeof e||void 0===e||\"function\"==typeof e&&\"\"===e.name},n=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).strict,r=void 0!==e&&e;!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.strict=r,this.rules=new Map,this.policies=new Map,this.registry=new WeakMap}var n,i,o;return n=t,(i=[{key:\"rule\",value:function(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r(t)&&(i=void 0===t||t,t=\"GLOBAL_RULE\");var o=this.subjectMapper(t),a=Array.isArray(e)?e:[e];return a.forEach(function(e){var t=n.rules.get(o)||{};t[e]=i,n.rules.set(o,t)}),this}},{key:\"policy\",value:function(e,t){var r=\"function\"==typeof e?new e:e,n=this.subjectMapper(t);return this.policies.set(n,r),this}},{key:\"register\",value:function(e,t){return this.registry.set(e,t),this}},{key:\"can\",value:function(e,t,r){r=void 0===r?\"GLOBAL_RULE\":r;var n=this.subjectMapper(r),i=this.policies.get(n),o=i||this.rules.get(n);if(void 0===o){if(this.strict)throw new Error('Unknown subject \"'.concat(n,'\"'));return!1}for(var a=arguments.length,s=new Array(a>3?a-3:0),u=3;u<a;u++)s[u-3]=arguments[u];if(i&&\"function\"==typeof i.beforeAll){var c=i.beforeAll.apply(i,[t,e,r,n].concat(s));if(void 0!==c)return c}if(\"function\"==typeof o[t])return Boolean(o[t].apply(o,[e,r,n].concat(s)));if(this.strict&&void 0===o[t])throw new Error('Unknown verb \"'.concat(t,'\"'));return Boolean(o[t])}},{key:\"some\",value:function(e,t,r){for(var n=this,i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];return r.some(function(r){return n.can.apply(n,[e,t,r].concat(o))})}},{key:\"every\",value:function(e,t,r){for(var n=this,i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];return r.every(function(r){return n.can.apply(n,[e,t,r].concat(o))})}},{key:\"mixin\",value:function(e){var t=this;return e.prototype.can=function(){return t.can.apply(t,[this].concat(Array.prototype.slice.call(arguments)))},e.prototype.can.every=function(){return t.every.apply(t,[this].concat(Array.prototype.slice.call(arguments)))},e.prototype.can.some=function(){return t.some.apply(t,[this].concat(Array.prototype.slice.call(arguments)))},this}},{key:\"subjectMapper\",value:function(e){if(\"string\"==typeof e)return e;var t=\"function\"==typeof e;return t&&this.registry.has(e)?this.registry.get(e):!t&&this.registry.has(e.constructor)?this.registry.get(e.constructor):t?e.name:e.constructor.name}},{key:\"reset\",value:function(){return this.rules=new Map,this.policies=new Map,this.registry=new WeakMap,this}},{key:\"removeRules\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.subjectMapper(e);if(this.rules.has(r)){if(t){var n=this.rules.get(r);return delete n[t],this}this.rules.delete(r)}return this}},{key:\"removePolicy\",value:function(e){var t=this.subjectMapper(e);return this.policies.delete(t),this}},{key:\"removeAll\",value:function(e){return this.removeRules(e),this.removePolicy(e),this}}])&&e(n.prototype,i),o&&e(n,o),t}();export default n;export{t as GlobalRule};\n//# sourceMappingURL=browser-acl.esm.js.map\n","import Acl, { GlobalRule } from 'browser-acl'\n\n/**\n * VueAcl constructor function\n *\n * ```javascript\n * import Vue from 'vue'\n * import Acl from 'vue-browser-acl'\n *\n * Vue.use(Acl, user, (acl) => {\n *   acl.rule(view, Post)\n *   acl.rule([edit, delete], Post, (user, post) => post.userId === user.id)\n *   acl.rule('moderate', Post, (user) => user.isModerator())\n * })\n * ```\n *\n * @access public\n * @param {Function|Object} user A user instance or a function that returns the user\n * @param {Function|Object} setupCallback A configured Acl instance or a callback callback that adds rules and policies.\n * @param {Object}   options={}\n * @param {Object}  [options.acl={}] Options passed to the Acl constructor\n * @param {Boolean} [options.assumeGlobal=true] If no subject is specified in route assume it is a global rule\n * @param {Boolean} [options.caseMode=true] When true lower case subjects will be looked up on the vue context\n * @param {Boolean} [options.debug=false] Outputs errors and other useful information to the console\n * @param {Boolean} [options.directive='can'] Name of the directive, and helper function\n * @param {String}  [options.failRoute='/'] Set a default fail route\n * @param {Boolean} [options.helper=true] Adds helper function\n * @param {Boolean} [options.strict=false] Causes redirect to fail route if route permissions are absent\n * @param {?Object}  options.router Vue router\n */\nexport default {\n  install: function (Vue, user, setupCallback, options = {}) {\n    /* ensure userAccessor is function */\n    const userAccessor = typeof user === 'function' ? user : () => user\n\n    /* defaults */\n    const strict = Boolean(options.strict)\n    options = Object.assign(\n      {\n        acl: { strict },\n        assumeGlobal: !strict,\n        caseMode: true,\n        debug: false,\n        directive: 'can',\n        failRoute: '/',\n        helper: true,\n        strict: false,\n      },\n      options\n    )\n\n    /* setup acl */\n    let acl = setupCallback\n    if (typeof setupCallback === 'function') {\n      acl = new Acl(options.acl)\n      setupCallback(acl)\n    }\n\n    /* router init function */\n    acl.router = function (router) {\n      options.router = router\n\n      const canNavigate = (verb, subject, ...otherArgs) => {\n        return (subject && acl.can(userAccessor(), verb, subject, ...otherArgs)) ||\n          (!subject && !options.strict)\n      }\n\n      /* check for both can and role */\n      const getCan = meta => meta.can || meta.role\n\n      /* convert 'edit Post' to ['edit', 'Post'] */\n      const metaToStatementPair = meta => {\n        const [\n          verb = null,\n          subject = options.assumeGlobal ? GlobalRule : null\n        ] = (getCan(meta) || '').split(' ')\n        return [verb, subject]\n      }\n\n      /**\n       * chain all can-statements and functions as promises\n       * each can-function must return a promise (in strict\n       * mode at least). To break the chain return a none\n       * true value\n       */\n      const chainCans = (metas, to, from) => {\n        let fail = null\n        const chain = metas.reduce((chain, meta) => {\n          return chain\n            .then(result => {\n              if (result !== true) {\n                return result\n              }\n\n              fail = meta.fail\n\n              const can = getCan(meta)\n\n              const nextPromise = typeof can === 'function'\n                ? can(to, from, canNavigate)\n                : Promise.resolve(canNavigate(...metaToStatementPair(meta)))\n\n              if (options.strict && !(nextPromise instanceof Promise)) {\n                throw new Error('$route.meta.can must return a promise in strict mode')\n              }\n\n              return nextPromise\n            })\n            // convert errors to false\n            .catch(error => {\n              if (options.debug) {\n                console.error(error)\n              }\n              return false\n            })\n        }, Promise.resolve(true))\n        chain.getFail = () => fail\n        return chain\n      }\n\n      router.beforeEach((to, from, next) => {\n        const metas = to.matched\n          .filter(route => route.meta && getCan(route.meta))\n          .map(route => route.meta)\n\n        const chain = chainCans(metas, to, from)\n        chain.then(result => {\n          if (result === true) {\n            return next()\n          }\n          const fail = chain.getFail() === '$from'\n            ? from.path\n            : chain.getFail()\n          next(fail || options.failRoute)\n        })\n      })\n    }\n\n    /* init router */\n    if (options.router) {\n      acl.router(options.router)\n    }\n\n    /* create directive */\n    Vue.directive(options.directive, function(el, binding, vnode) {\n      const behaviour = binding.modifiers.disable ? 'disable' : 'hide'\n\n      let verb, verbArg, subject, params\n      verbArg = binding.arg\n      if (Array.isArray(binding.value) && binding.expression.startsWith('[')) {\n        [verb, subject, params] = binding.modifiers.global\n          ? arrayToGlobalExprTpl(binding)\n          : arrayToExprTpl(binding)\n      } else if (typeof binding.value === 'string') {\n        [verb, subject, params] = stringToExprTpl(binding, vnode, options)\n      } else if (verbArg && typeof binding.value === 'object') {\n        verb = verbArg\n        subject = binding.value\n        params = []\n      } else if (binding.value === undefined && !binding.modifiers.global && options.assumeGlobal) {\n        // Fall back to global if no value is provided\n        verb = verbArg\n        subject = GlobalRule\n        params = []\n      }\n\n      if (options.assumeGlobal && !subject) {\n        subject = GlobalRule\n        params = params || []\n        verb = verb || verbArg\n      }\n\n      if (!verb || !subject) {\n        throw new Error('Missing verb or subject')\n      }\n\n      const aclMethod =\n        (binding.modifiers.some && 'some') ||\n        (binding.modifiers.every && 'every') ||\n        'can'\n\n      const ok = acl[aclMethod](userAccessor(), verb, subject, ...params)\n      const not = binding.modifiers.not\n\n      el.disabled = false\n      el.readOnly = false\n      if ((ok && not) || (!ok && !not)) {\n        if (behaviour === 'hide') {\n          commentNode(el, vnode)\n        } else if (behaviour === 'disable') {\n          el.disabled = true\n        } else if (behaviour === 'readonly') {\n          el.readOnly = true\n        }\n      }\n    })\n\n    /* define helpers */\n    if (options.helper) {\n      const helper = `$${options.directive}`\n      Vue.prototype[helper] = function () {\n        return acl.can(userAccessor(), ...arguments)\n      }\n      Vue.prototype[helper].not = function () {\n        return !acl.can(userAccessor(), ...arguments)\n      }\n      Vue.prototype[helper].every = function () {\n        return acl.every(userAccessor(), ...arguments)\n      }\n      Vue.prototype[helper].some = function () {\n        return acl.some(userAccessor(), ...arguments)\n      }\n    }\n  }\n}\n\n/**\n * Create comment node\n *\n * @private\n * @author https://stackoverflow.com/questions/43003976/a-custom-directive-similar-to-v-if-in-vuejs#43543814\n */\nfunction commentNode(el, vnode) {\n  const comment = document.createComment(' ')\n\n  Object.defineProperty(comment, 'setAttribute', {\n    value: () => undefined\n  })\n\n  vnode.text = ' '\n  vnode.elm = comment\n  vnode.isComment = true\n  vnode.tag = undefined\n  vnode.data.directives = undefined\n\n  if (vnode.componentInstance) {\n    vnode.componentInstance.$el = comment\n  }\n\n  if (el.parentNode) {\n    el.parentNode.replaceChild(comment, el)\n  }\n}\n\n/**\n * Maps binding.value of type array to expression tuple\n */\nconst arrayToExprTpl = ({arg, value}) => ([\n  arg || value[0],\n  arg ? value[0] : value[1],\n  arg ? value.slice(1) : value.slice(2)\n])\n\n/**\n * Maps binding.value of type array to global expression tuple\n */\nconst arrayToGlobalExprTpl = ({arg, value}) => ([\n  arg || value[0],\n  GlobalRule,\n  arg ? value : value.slice(1)\n])\n\n/**\n * Maps binding.value of type string to expression tuple\n */\nconst stringToExprTpl = ({arg, value, modifiers}, vnode, options) => {\n  let [verb, subject] = arg ? [arg, value] : value.split(' ')\n\n  if (subject && modifiers.global) {\n    throw new Error('You cannot provide subject and use global modifier at the same time')\n  }\n\n  if (\n    typeof subject === 'string' &&\n    options.caseMode &&\n    subject[0].match(/[a-z]/)\n  ) {\n    subject = vnode.context[subject]\n  }\n\n  return [verb, subject, []]\n}\n"],"names":["t","r","e","name","n","arguments","length","strict","TypeError","this","rules","Map","policies","registry","WeakMap","i","key","value","o","subjectMapper","a","Array","isArray","forEach","get","set","Error","concat","s","u","beforeAll","c","apply","Boolean","some","can","every","prototype","slice","call","has","constructor","delete","removeRules","removePolicy","enumerable","configurable","writable","Object","defineProperty","install","Vue","user","setupCallback","options","userAccessor","assign","acl","assumeGlobal","caseMode","debug","directive","failRoute","helper","Acl","router","canNavigate","verb","subject","otherArgs","getCan","meta","role","chainCans","metas","to","from","fail","chain","reduce","then","result","nextPromise","Promise","resolve","GlobalRule","split","metaToStatementPair","catch","error","console","getFail","beforeEach","next","matched","filter","route","map","path","el","binding","vnode","behaviour","modifiers","disable","verbArg","params","arg","expression","startsWith","global","arrayToGlobalExprTpl","arrayToExprTpl","stringToExprTpl","undefined","aclMethod","ok","not","disabled","readOnly","comment","document","createComment","text","elm","isComment","tag","data","directives","componentInstance","$el","parentNode","replaceChild","commentNode","match","context"],"mappings":"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"}