var VueBrowserAcl=function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}const o="GLOBAL_RULE",i=t=>"boolean"==typeof t||void 0===t||"function"==typeof t&&""===t.name;class a{constructor({strict:t=!1}={}){this.strict=t,this.rules=new Map,this.policies=new Map,this.registry=new WeakMap}rule(t,e,r=!0){i(e)&&(r=void 0===e||e,e=o);const n=this.subjectMapper(e);return(Array.isArray(t)?t:[t]).forEach(t=>{const e=this.rules.get(n)||{};e[t]=r,this.rules.set(n,e)}),this}policy(t,e){const r="function"==typeof t?new t:t,n=this.subjectMapper(e);return this.policies.set(n,r),this}register(t,e){return this.registry.set(t,e),this}can(t,e,r,...n){r=void 0===r?o:r;const i=this.subjectMapper(r),a=this.policies.get(i),s=a||this.rules.get(i);if(void 0===s){if(this.strict)throw new Error(`Unknown subject "${i}"`);return!1}if(a&&"function"==typeof a.beforeAll){const o=a.beforeAll(e,t,r,i,...n);if(void 0!==o)return o}if("function"==typeof s[e])return Boolean(s[e](t,r,i,...n));if(this.strict&&void 0===s[e])throw new Error(`Unknown verb "${e}"`);return Boolean(s[e])}some(t,e,r,...n){return r.some(r=>this.can(t,e,r,...n))}every(t,e,r,...n){return r.every(r=>this.can(t,e,r,...n))}mixin(t){const e=this;return t.prototype.can=function(){return e.can(this,...arguments)},t.prototype.can.every=function(){return e.every(this,...arguments)},t.prototype.can.some=function(){return e.some(this,...arguments)},this}subjectMapper(t){if("string"==typeof t)return t;const e="function"==typeof t;return e&&this.registry.has(t)?this.registry.get(t):!e&&this.registry.has(t.constructor)?this.registry.get(t.constructor):e?t.name:t.constructor.name}reset(){return this.rules=new Map,this.policies=new Map,this.registry=new WeakMap,this}removeRules(t,e=null){const r=this.subjectMapper(t);if(this.rules.has(r)){if(e)return delete this.rules.get(r)[e],this;this.rules.delete(r)}return this}removePolicy(t){const e=this.subjectMapper(t);return this.policies.delete(e),this}removeAll(t){return this.removeRules(t),this.removePolicy(t),this}}var s={install:function(t,i,s){var p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},y="function"==typeof i?i:function(){return i},h=Boolean(p.strict);p=Object.assign({acl:{strict:h},assumeGlobal:!h,caseMode:!0,debug:!1,directive:"can",failRoute:"/",helper:!0,strict:!1},p);var v=s;if(s instanceof a||s(v=new a(p.acl)),v.router=function(t){p.router=t;var e=function(t,e){for(var r,n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return e&&(r=v).can.apply(r,[y(),t,e].concat(o))||!e&&!p.strict},i=function(t,i,a){var s=null,c=t.reduce(function(t,c){return t.then(function(t){if(!0!==t)return t;s=c.fail;var u="function"==typeof c.can?c.can(i,a,e):Promise.resolve(e.apply(void 0,n(function(t){var e=r((t.can||"").split(" "),2),n=e[0],i=void 0===n?null:n,a=e[1];return[i,void 0===a?p.assumeGlobal?o:null:a]}(c))));if(p.strict&&!(u instanceof Promise))throw new Error("$route.meta.can must return a promise in strict mode");return u}).catch(function(t){return p.debug&&console.error(t),!1})},Promise.resolve(!0));return c.getFail=function(){return s},c};t.beforeEach(function(t,e,r){var n=t.matched.filter(function(t){return t.meta&&t.meta.can}).map(function(t){return t.meta}),o=i(n,t,e);o.then(function(t){if(!0===t)return r();var n="$from"===o.getFail()?e.path:o.getFail();r(n||p.failRoute)})})},p.router&&v.router(p.router),t.directive(p.directive,function(t,i,a){var s,h,m,d,b,g=i.modifiers.disable?"disable":"hide";if(m=i.arg,Array.isArray(i.value)){var w=r(i.modifiers.global?l(i):u(i),3);h=w[0],d=w[1],b=w[2]}else if("string"==typeof i.value){var A=r(f(i,a,p),3);h=A[0],d=A[1],b=A[2]}else m&&"object"===e(i.value)?(h=m,d=i.value,b=[]):void 0===i.value&&!i.modifiers.global&&p.assumeGlobal&&(h=m,d=o,b=[]);if(p.assumeGlobal&&!d&&(d=o,b=b||[],h=h||m),!h||!d)throw new Error("Missing verb or subject");var j=(i.modifiers.some?"some":i.modifiers.every&&"every")||"can",M=(s=v)[j].apply(s,[y(),h,d].concat(n(b))),E=i.modifiers.not;(M&&E||!M&&!E)&&("hide"===g?c(t,a):"disable"===g?t.disabled=!0:"readonly"===g&&(t.readOnly=!0))}),p.helper){var m="$".concat(p.directive);t.prototype[m]=function(){var t;return(t=v).can.apply(t,[y()].concat(Array.prototype.slice.call(arguments)))},t.prototype[m].not=function(){var t;return!(t=v).can.apply(t,[y()].concat(Array.prototype.slice.call(arguments)))},t.prototype[m].every=function(){var t;return(t=v).every.apply(t,[y()].concat(Array.prototype.slice.call(arguments)))},t.prototype[m].some=function(){var t;return(t=v).some.apply(t,[y()].concat(Array.prototype.slice.call(arguments)))}}}};function c(t,e){var r=document.createComment(" ");Object.defineProperty(r,"setAttribute",{value:function(){}}),e.text=" ",e.elm=r,e.isComment=!0,e.tag=void 0,e.data.directives=void 0,e.componentInstance&&(e.componentInstance.$el=r),t.parentNode&&t.parentNode.replaceChild(r,t)}var u=function(t){var e=t.arg,r=t.value;return[e||r[0],e?r[0]:r[1],e?r.slice(1):r.slice(2)]},l=function(t){var e=t.arg,r=t.value;return[e||r[0],o,e?r:r.slice(1)]},f=function(t,e,n){var o=t.arg,i=t.value,a=t.modifiers,s=r(o?[o,i]:i.split(" "),2),c=s[0],u=s[1];if(u&&a.global)throw new Error("You cannot provide subject and use global modifier at the same time");return"string"==typeof u&&n.caseMode&&u[0].match(/[a-z]/)&&(u=e.context[u]),[c,u,[]]};return t.default=s,t}({});
//# sourceMappingURL=vue-browser-acl.umd.js.map
